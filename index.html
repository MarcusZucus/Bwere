<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#F5F5F5">
  <title>Werbly</title>

  <!-- Manifest para PWA -->
  <link rel="manifest" href="/manifest.json">

  <!-- Meta para el color del tema -->
  <meta name="theme-color" content="#F5F5F5">

  <!-- Enlace a Font Awesome para los íconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <!-- Fuente Quicksand -->
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600&display=swap" rel="stylesheet">

  <!-- Enlace al archivo CSS -->
  <link rel="stylesheet" href="/html_modules/styles.css">

  <!-- Scripts de los módulos -->
  <script defer type="module" src="/html_modules/modules/chat.js"></script>
  <script defer type="module" src="/html_modules/modules/menu.js"></script>
  <script defer type="module" src="/html_modules/modules/animations.js"></script>
  <script defer src="/prevent-scroll.js"></script>
  <script defer type="module" src="/service-worker-registration.js"></script>

  <style>
    /* Estilos para el indicador de carga */
    #loading-indicator {
      display: none; /* Oculto por defecto */
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
    }

    .animation-container {
      position: relative;
      width: 400px;
      height: 200px;
    }

    .heart {
      position: absolute;
      width: 30px;
      height: 30px;
      background-color: #EEEEEE;
      left: 0;
      top: 85px;
      transform: rotate(45deg);
      border-radius: 20% 20% 40% 40%;
      animation: pulse 1.5s infinite, colorShift 1.5s infinite;
    }

    .heart:before,
    .heart:after {
      content: "";
      position: absolute;
      width: 30px;
      height: 30px;
      background-color: inherit;
      border-radius: 50%;
    }

    .heart:before {
      top: -15px;
      left: 0;
    }

    .heart:after {
      left: -15px;
      top: 0;
    }

    svg .line {
      stroke: #EEEEEE;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-dasharray: 400;
      stroke-dashoffset: 400;
      animation: draw 1.5s linear infinite, fadeOut 1.5s linear infinite;
    }

    @keyframes pulse {
      0%, 25% {
        transform: scale(1) rotate(45deg);
      }
      50% {
        transform: scale(1.2) rotate(45deg);
      }
      75%, 100% {
        transform: scale(1) rotate(45deg);
      }
    }

    @keyframes colorShift {
      0% {
        background-color: #EEEEEE;
      }
      50% {
        background-color: #444444;
      }
      100% {
        background-color: #EEEEEE;
      }
    }

    @keyframes draw {
      0% {
        stroke-dashoffset: 400;
      }
      100% {
        stroke-dashoffset: -400;
      }
    }

    @keyframes fadeOut {
      0%, 70% {
        opacity: 1;
      }
      100% {
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div id="chat-container">
    <!-- Encabezado -->
    <div id="chat-header">
      <span style="font-family: 'Quicksand', sans-serif; font-weight: 600;">Werbly</span>
      <!-- Botón del menú -->
      <button id="menu-button">
        <span class="line line-1"></span>
        <span class="line line-2"></span>
      </button>
    </div>

    <!-- Área de Mensajes -->
    <div id="messages">
      <!-- Contenedor inicial de mensajes vacío -->
    </div>

    <!-- Barra de Entrada -->
    <div id="input-area">
      <!-- Botón de adjuntar archivos con el ícono -->
      <button id="attach-button">
        <i class="fas fa-paperclip"></i> <!-- Ícono de adjuntar archivo -->
      </button>
      <!-- Campo de entrada -->
      <input id="message-input" type="text" placeholder="Escribe un mensaje..." />
      <!-- Botón de enviar mensaje con el ícono -->
      <button id="send-button">
        <i class="fas fa-paper-plane"></i> <!-- Ícono de enviar mensaje -->
      </button>
    </div>
  </div>

  <!-- Menú Lateral -->
  <div id="sidebar">
    <h2>Conversaciones</h2>
    <div class="conversation" data-id="1">Conversación 1</div>
    <div class="conversation" data-id="2">Conversación 2</div>
    <div class="conversation" data-id="3">Conversación 3</div>
  </div>

  <!-- Indicador de Carga -->
  <div id="loading-indicator">
    <div class="animation-container">
      <div class="heart"></div>
      <svg viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
        <path class="line" d="
          M30,100 L100,100 Q120,70 140,100 Q160,130 180,100 
          Q200,70 220,100 Q240,130 260,100 Q280,70 300,100 
          L370,100
        " />
      </svg>
    </div>
  </div>

  <!-- JavaScript para ajustar la posición del input-area -->
  <script>
    // Detecta cambios en el tamaño de la ventana
    window.addEventListener('resize', () => {
      const inputArea = document.getElementById('input-area');
      const messagesArea = document.getElementById('messages');
      const viewportHeight = window.innerHeight;

      // Si la altura de la ventana disminuye (teclado visible)
      if (viewportHeight < 600) {
        inputArea.style.position = 'fixed'; // Siempre visible
        inputArea.style.bottom = '0';      // Por encima del teclado
        inputArea.style.zIndex = '1000';   // Mayor z-index para asegurar que esté al frente

        // Ajustar la altura del área de mensajes
        messagesArea.style.paddingBottom = '120px'; // Espacio adicional para evitar solapamientos
      } else {
        // Restaurar posición y altura cuando el teclado no esté visible
        inputArea.style.position = 'fixed';
        inputArea.style.bottom = '0';
        messagesArea.style.paddingBottom = '60px'; // Altura normal del input-area
      }
    });

    // Ajuste inicial al cargar la página
    window.dispatchEvent(new Event('resize'));

    // Mostrar/Ocultar indicador de carga
    function showLoadingIndicator() {
      document.getElementById('loading-indicator').style.display = 'flex';
    }

    function hideLoadingIndicator() {
      document.getElementById('loading-indicator').style.display = 'none';
    }
  </script>

  <!-- Registro del Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(function(registration) {
          console.log('Service Worker registered with scope:', registration.scope);
        })
        .catch(function(error) {
          console.log('Service Worker registration failed:', error);
        });
    }
  </script>
</body>
</html>
